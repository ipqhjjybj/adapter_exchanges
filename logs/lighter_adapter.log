2025-11-27 12:42:12,152 [INFO] - get_account_info success, account_index: 558819
2025-11-27 12:42:13,973 [WARNING] - get_orderbook_ticker 返回失败，准备重试 (1/3)
2025-11-27 12:42:15,478 [WARNING] - get_orderbook_ticker 返回失败，准备重试 (2/3)
2025-11-27 12:43:07,734 [INFO] - get_account_info success, account_index: 558819
2025-11-27 12:43:39,644 [WARNING] - get_orderbook_ticker 失败，准备重试 (1/3): BookTicker.__init__() got an unexpected keyword argument 'bid_qty'
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/src/utils.py", line 258, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 217, in get_orderbook_ticker
    data=BookTicker(
         ^^^^^^^^^^^
TypeError: BookTicker.__init__() got an unexpected keyword argument 'bid_qty'
2025-11-27 12:44:07,095 [INFO] - get_account_info success, account_index: 558819
2025-11-27 12:45:10,139 [INFO] - get_account_info success, account_index: 558819
2025-11-27 12:47:55,233 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:13:37,607 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:14:02,687 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:15:06,949 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:16:11,064 [ERROR] - 下市价开仓单失败: argument 2: TypeError: wrong type
2025-11-27 13:16:45,243 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:18:20,798 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:18:50,880 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:22:42,288 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:22:44,299 [ERROR] - 下市价开仓单失败: 'LightAdapter' object has no attribute 'loop'
2025-11-27 13:22:58,744 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:23:03,812 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:24:43,730 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:24:45,730 [ERROR] - 下市价开仓单失败: 'LightAdapter' object has no attribute 'loop'
2025-11-27 13:25:05,049 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:25:07,033 [ERROR] - 下市价开仓单失败: LightAdapter.create_market_order_async() got an unexpected keyword argument 'market_index'
2025-11-27 13:26:06,196 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:27:39,131 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:27:47,131 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:31:57,190 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:32:04,229 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:33:49,926 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:33:52,187 [ERROR] - 下市价开仓单失败: 'LightAdapter' object has no attribute 'create_market_order_async'
2025-11-27 13:36:23,787 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:36:26,289 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:39:39,447 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:39:42,225 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:42:36,364 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:42:39,771 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:49:02,346 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:52:12,095 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:52:50,259 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:52:52,040 [ERROR] - 下市价开仓单失败: 'LightAdapter' object has no attribute 'create_market_order_async'
2025-11-27 13:55:47,901 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:56:04,522 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 13:58:28,949 [INFO] - get_account_info success, account_index: 558819
2025-11-27 13:58:34,122 [ERROR] - 下市价开仓单失败: Timeout context manager should be used inside a task
2025-11-27 14:01:00,111 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:09:46,004 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:09:46,799 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:09:47,254 [INFO] - new token created:1764252000:558819:2:4221efc02d6d5f95bcad75abc438444be729e1e25138c472c68ae8154c895a43d06b94510aff4c476e6f2b023cdffd5632d9e6341471f7b310a1deaefca41d93989a9b2d4cf35dd622d8c49fcaea8047
2025-11-27 14:16:28,940 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:16:29,513 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:20:50,528 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:20:51,096 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:31:21,113 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:31:21,682 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:31:48,720 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:31:49,302 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:33:04,145 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:33:04,723 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:35:44,165 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:35:44,748 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:40:00,682 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:40:01,241 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:40:55,507 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:40:56,079 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:41:49,094 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:41:49,662 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:42:13,903 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:42:14,472 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:42:42,092 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:42:42,662 [INFO] - auth token near expired, re-create auth token
2025-11-27 14:48:33,427 [INFO] - get_account_info success, account_index: 558819
2025-11-27 14:48:33,992 [INFO] - auth token near expired, re-create auth token
2025-11-27 15:07:46,739 [INFO] - get_account_info success, account_index: 558819
2025-11-27 15:07:47,738 [ERROR] - 查询持仓失败: {"code":20001,"message":"invalid param: : field \"by\" is not set"}
2025-11-27 15:07:47,739 [WARNING] - query_position 返回失败，准备重试 (1/3)
2025-11-27 15:07:49,186 [ERROR] - 查询持仓失败: {"code":20001,"message":"invalid param: : field \"by\" is not set"}
2025-11-27 15:07:49,186 [WARNING] - query_position 返回失败，准备重试 (2/3)
2025-11-27 15:08:25,137 [INFO] - get_account_info success, account_index: 558819
2025-11-27 15:08:26,182 [ERROR] - 查询持仓失败: 'positions'
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 410, in query_position
    for position_item in data["positions"]:
                         ~~~~^^^^^^^^^^^^^
KeyError: 'positions'
2025-11-27 15:08:26,183 [WARNING] - query_position 返回失败，准备重试 (1/3)
2025-11-27 15:08:27,639 [ERROR] - 查询持仓失败: 'positions'
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 410, in query_position
    for position_item in data["positions"]:
                         ~~~~^^^^^^^^^^^^^
KeyError: 'positions'
2025-11-27 15:08:27,639 [WARNING] - query_position 返回失败，准备重试 (2/3)
2025-11-27 15:09:19,762 [INFO] - get_account_info success, account_index: 558819
2025-11-27 15:09:21,158 [ERROR] - 查询持仓失败: SymbolPosition.__init__() missing 1 required positional argument: 'api_resp'
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 417, in query_position
    symbol_position = SymbolPosition(
                      ^^^^^^^^^^^^^^^
TypeError: SymbolPosition.__init__() missing 1 required positional argument: 'api_resp'
2025-11-27 15:09:21,159 [WARNING] - query_position 返回失败，准备重试 (1/3)
2025-11-27 15:09:22,624 [ERROR] - 查询持仓失败: SymbolPosition.__init__() missing 1 required positional argument: 'api_resp'
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 417, in query_position
    symbol_position = SymbolPosition(
                      ^^^^^^^^^^^^^^^
TypeError: SymbolPosition.__init__() missing 1 required positional argument: 'api_resp'
2025-11-27 15:09:22,625 [WARNING] - query_position 返回失败，准备重试 (2/3)
2025-11-27 15:09:55,730 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:24:10,951 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:24:11,518 [INFO] - auth token near expired, re-create auth token
2025-11-27 16:24:11,984 [INFO] - new token created:1764252000:558819:2:05ec722d35819c9b6d0075ed0413fa3ed3140f9c479b781773f328fa28e53534f525c683a1dfe43ad20b278dfd764f0dfdb17b1603d207f4938f7f5bb9d3af13558c4f346a0484c11e4b1e70f4615916
2025-11-27 16:24:12,942 [ERROR] - 查询订单失败: name 'OrderStatus' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 501, in query_order
    order_status = OrderStatus.CANCELED
                   ^^^^^^^^^^^
NameError: name 'OrderStatus' is not defined
2025-11-27 16:24:12,943 [WARNING] - query_order 返回失败，准备重试 (1/3)
2025-11-27 16:24:15,011 [ERROR] - 查询订单失败: name 'OrderStatus' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 501, in query_order
    order_status = OrderStatus.CANCELED
                   ^^^^^^^^^^^
NameError: name 'OrderStatus' is not defined
2025-11-27 16:24:15,011 [WARNING] - query_order 返回失败，准备重试 (2/3)
2025-11-27 16:25:04,924 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:25:05,512 [INFO] - auth token near expired, re-create auth token
2025-11-27 16:25:05,981 [INFO] - new token created:1764252000:558819:2:657f3059bf11651723f68fecaad7a97ad6b0d7c034271ec049c094df6c54a30b40d0765419ff410625d376aaaf6dbf91b74d09d1186ef5856be11d50b202eec23d9b8d9c62c4282a27f41f22b30f6d28
2025-11-27 16:25:59,195 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:25:59,767 [INFO] - auth token near expired, re-create auth token
2025-11-27 16:26:00,232 [INFO] - new token created:1764252000:558819:2:80a78509e28e4e69952a5f8620bd67017408003237e7ae91737ce3b75b12b92a16ae3e6dc332104b2b8713108b1afa99b2f2ff49a50f16d8fc4997d36700b7113b5cc25f46634bbd195db194f4eb7905
2025-11-27 16:32:39,686 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:32:40,454 [ERROR] - 取消所有订单失败: name '_create_market_order_with_new_client' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 575, in cancel_all_orders
    x, tx_hash, err = asyncio.run(_create_market_order_with_new_client())
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name '_create_market_order_with_new_client' is not defined
2025-11-27 16:32:54,066 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:32:55,106 [ERROR] - 取消所有订单失败: name 'client' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 575, in cancel_all_orders
    x, tx_hash, err = asyncio.run(_cancel_all_order_with_new_client())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/envs/alphalib/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/envs/alphalib/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/envs/alphalib/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 568, in _cancel_all_order_with_new_client
    result = await new_client.cancel_all_orders(time_in_force=client.CANCEL_ALL_TIF_IMMEDIATE, timestamp_ms=0)
                                                              ^^^^^^
NameError: name 'client' is not defined
2025-11-27 16:33:20,907 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:33:22,375 [ERROR] - 取消所有订单失败: name 'data' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 584, in cancel_all_orders
    return AdapterResponse(success=True, data=data, error_msg="")
                                              ^^^^
NameError: name 'data' is not defined
2025-11-27 16:34:10,822 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:34:43,001 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:46:26,009 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:46:58,745 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:47:39,466 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:47:46,882 [ERROR] - 下限价单失败: name 'client' is not defined
2025-11-27 16:47:59,399 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:49:09,077 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:53:49,246 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:53:49,805 [WARNING] - get_net_value 失败，准备重试 (1/3): LightAdapter.get_net_value() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/src/utils.py", line 258, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
TypeError: LightAdapter.get_net_value() takes 1 positional argument but 2 were given
2025-11-27 16:53:50,812 [WARNING] - get_net_value 失败，准备重试 (2/3): LightAdapter.get_net_value() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/src/utils.py", line 258, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
TypeError: LightAdapter.get_net_value() takes 1 positional argument but 2 were given
2025-11-27 16:53:51,816 [ERROR] - get_net_value 重试3次后失败: LightAdapter.get_net_value() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/src/utils.py", line 258, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
TypeError: LightAdapter.get_net_value() takes 1 positional argument but 2 were given
2025-11-27 16:54:03,631 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:54:04,209 [ERROR] - 获取净价值失败: name 'symbol' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 668, in get_net_value
    market_id = self.market_index_dic[symbol]
                                      ^^^^^^
NameError: name 'symbol' is not defined
2025-11-27 16:54:04,210 [WARNING] - get_net_value 返回失败，准备重试 (1/3)
2025-11-27 16:54:05,212 [ERROR] - 获取净价值失败: name 'symbol' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 668, in get_net_value
    market_id = self.market_index_dic[symbol]
                                      ^^^^^^
NameError: name 'symbol' is not defined
2025-11-27 16:54:05,212 [WARNING] - get_net_value 返回失败，准备重试 (2/3)
2025-11-27 16:54:06,216 [ERROR] - 获取净价值失败: name 'symbol' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 668, in get_net_value
    market_id = self.market_index_dic[symbol]
                                      ^^^^^^
NameError: name 'symbol' is not defined
2025-11-27 16:54:24,523 [INFO] - get_account_info success, account_index: 558819
2025-11-27 16:57:59,765 [INFO] - get_account_info success, account_index: 558819
2025-11-27 17:03:20,317 [INFO] - get_account_info success, account_index: 558819
2025-11-27 17:06:21,931 [INFO] - get_account_info success, account_index: 558819
2025-11-27 17:06:22,494 [INFO] - auth token near expired, re-create auth token
2025-11-27 17:06:22,958 [INFO] - new token created:1764252000:558819:2:7d380e58b472b48fe17e547786da59285059e2ade855835358667f4f6cdc7d72aa05176c6bd2773966b97d4f4687e1e276e56963249b0e0e654dfcb5768eac43b6b7a29bfa1f698b2fc56f4e98144915
2025-11-27 17:15:48,698 [INFO] - get_account_info success, account_index: 558819
2025-11-27 17:15:49,717 [ERROR] - 获取账户信息失败: name 'account' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 826, in get_um_account_info
    positions = account.get("positions", [])
                ^^^^^^^
NameError: name 'account' is not defined
2025-11-27 17:16:16,765 [INFO] - get_account_info success, account_index: 558819
2025-11-27 17:16:22,798 [ERROR] - 获取账户信息失败: name 'api_resp' is not defined
Traceback (most recent call last):
  File "/Users/shenzhuoheng/quant_yz/git/adapter_exchanges/lighter_exchanges/lighter_adapter.py", line 820, in get_um_account_info
    account = api_resp.get("accounts", [{}])[0]
              ^^^^^^^^
NameError: name 'api_resp' is not defined
2025-11-27 17:16:43,081 [INFO] - get_account_info success, account_index: 558819
